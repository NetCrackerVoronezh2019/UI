<body>
  <app-navbar></app-navbar>
 <div id="sidebar">
   <li class='dialog'>
     <img *ngIf="dialog?.image==null" src='https://www.egalochkina.ru/wp-content/uploads/2018/03/dialog-sokrata.jpg'/>
     <img *ngIf="dialog?.image!=null && loading"  [src]="dialogImage"/>
     <div class='name'>
       {{dialog?.name}}
     </div>
   </li>
   <div *ngIf="!userSearchPanelVisible && !settingsVisible">
   <button mat-raised-button class="ml-2" *ngIf="dialog?.type=='public'" (click)="openUserAddForm()"><i class="fas fa-plus-circle"></i>Добавить пользователя</button>
   <button mat-raised-button class="ml-2" *ngIf="dialog?.type=='public'" (click)="liveDialog()"><i class="fas fa-minus-circle"></i>Покинуть диалог</button>
   <div *ngIf="dialog?.creatorId == user?.userId">
     <button mat-raised-button class="ml-2" *ngIf="dialog?.type=='public'" (click)="deleteDialog()"><i class="fas fa-minus-circle"></i>Удалить диалог</button>
     <button mat-raised-button class="ml-2" *ngIf="dialog?.type=='public'" (click)="showSettings()"><i class="fas fa-minus-circle"></i>Настройки</button>
   </div>
   Участники:
   <div *ngFor ='let user of dialogMembers'>
     <app-dialog-member-card [(us)]="user"></app-dialog-member-card>
   </div>
   </div>
   <div *ngIf="settingsVisible">
     <h3>Настройки чата</h3>
     <form [formGroup]="dgService.getDialogSettingsForm()">
         <div class="form-group">
           <label for="">Имя чата</label>
           <input id="Name" type="text" class="form-control" formControlName="name" autocomplete="off" placeholder="Dialog name">
           <div *ngIf="dgService.getDialogSettingsForm().controls['name'].invalid && dgService.getDialogSettingsForm().controls['name'].touched" >
             <small  *ngIf="dgService.getDialogSettingsForm().controls['name'].errors.minlength">name is too short</small>
             <small  *ngIf="dgService.getDialogSettingsForm().controls['name'].errors.maxlength">name is too long</small>
           </div>
         </div>
     </form>
     <button mat-raised-button class="ml-2" (click)="acceptSettings()"><i class="fas fa-check-circle"></i>Изменить</button>
     <button mat-raised-button class="ml-2" (click)="closeSetings()"><i class="fas fa-minus-circle"></i>Закрыть</button>
     <input type="file" name="file" id="file"  (change)="handleFileInput($event.target.files)" multiple accept="image/*" class="input-file"/>
     <label for="file" class="btn btn-tertiary js-labelFile">
       <button class="js-fileName" *ngIf="avatar!=undefined" (click)="setAvatar()"><i class="icon fa fa-check"></i> Изменить Аватар</button>
     </label>
     </div>
   <div *ngIf="userSearchPanelVisible">
     <form [formGroup]="dgService.getUserSearchForm()">
       <h5>Поиск</h5>
       <label for="">Имя</label>
       <input type="text" class="form-control" formControlName="firstName" autocomplete="off" placeholder="first name">
       <div *ngIf="dgService.getUserSearchForm().controls['firstName'].invalid && dgService.getUserSearchForm().controls['firstName'].touched" >
         <small  *ngIf="dgService.getUserSearchForm().controls['firstName'].errors.minlength">name is too short</small>
         <small  *ngIf="dgService.getUserSearchForm().controls['firstName'].errors.maxlength">name is too long</small>
       </div>
       <label for="">Фамилия</label>
       <input type="text" class="form-control" formControlName="lastName" autocomplete="off" placeholder="last name">
       <div *ngIf="dgService.getUserSearchForm().controls['lastName'].invalid && dgService.getUserSearchForm().controls['lastName'].touched" >
         <small  *ngIf="dgService.getUserSearchForm().controls['lastName'].errors.minlength">name is too short</small>
         <small  *ngIf="dgService.getUserSearchForm().controls['lastName'].errors.maxlength">name is too long</small>
       </div>
     </form>
     <button mat-raised-button class="ml-2" (click)="search()"><i class="fas fa-search"></i>Поиск</button>
     <button mat-raised-button class="ml-2" (click)="closeUserAddForm()"><i class="fas fa-minus-circle"></i>Отмена</button>
   <div *ngFor ='let us of users' align="center">
     <app-user-card [(us)]="us" *ngIf="user.userId != us.userId" (click)="invite(us)"></app-user-card>
   </div>
  </div>
 </div>
 <div id="Sending">
   <form class="mt-5" [formGroup]="dgService.getMessageForm()">
     <div class="container">
       <div class="form-group">
         <textarea id="message" placeholder="Write your message" type="text" class="form-control" formControlName="text" [(ngModel)]="textbox"></textarea>
         <button class="btn btn-light btn-primary-spacing" (click)="sendMessage()">Отправить</button>
         <div class="example-2 mb-3">
               <input type="file" name="file" id="file"  (change)="handleFileMessageInput($event.target.files)"  multiple accept="image/*, application/pdf" class="input-file"/>
               <label for="file" class="btn btn-tertiary js-labelFile">
                 <i class="icon fa fa-check"></i>
                 <span class="js-fileName"> Загрузить Файлы</span>
               </label>
            </div>
       </div>
    </div>
   </form>
   <div class="form-group">
   </div>
   <div class="mb-2 all-images">
       <div class="mb-3" *ngFor="let not of allNames; let i = index" (click)="deleteImageFromList(i)">
           <span  matBadge="x"  matBadgeOverlap="false" >{{not}}</span>
       </div>
  </div>
 </div>
 <div id="content" #scrollMe [scrollTop]="scrollMe.scrollHeight">
       <ul *ngFor ='let message of messages'>
         <app-message-card [(message)]="message" (imageClick)="openImage($event)" [(mymessage)]="message.sender.userId == user.userId"></app-message-card>
       </ul>
 </div>
 <div *ngIf="fullImage!=null" class="fullImage">
   <img [src]="fullImage" (click)="closeImage()">
 </div>
</body>
